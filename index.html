<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ì‹œ ìŠ¤ì¼€ì´íŠ¸ë³´ë“œ íŒŒí¬ ì§€ë„ (Complete)</title>
    
    <style>
        /* 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif;}
        .container { position: relative; width: 100%; height: 100%; }
        #map { width: 100%; height: 100%; }

        /* 2. ì‚¬ì´ë“œë°” (ë¦¬ìŠ¤íŠ¸) */
        .sidebar { position: absolute; top: 15px; left: 15px; bottom: 15px; width: 360px; background: rgba(255, 255, 255, 0.95); z-index: 20; box-shadow: 0 5px 15px rgba(0,0,0,0.15); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .search-box { padding: 15px; border-bottom: 1px solid #eee; }
        .search-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; }
        .park-list { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        .park-item { padding: 18px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.2s; }
        .park-item:hover { background: #f1f8ff; }
        .item-title { font-weight: bold; font-size: 15px; display: block; color: #222; margin-bottom: 5px;}
        .item-desc { font-size: 13px; color: #777; line-height: 1.4; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; color: white; font-weight: bold; margin-left: 5px; vertical-align: middle;}
        .hard { background-color: #ff4757; } .medium { background-color: #ffa502; } .easy { background-color: #2ed573; }

        /* 3. ì •ë³´ì°½ (ë§ˆì»¤ í´ë¦­ ì‹œ) */
        .wrap { width: 280px; background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); overflow: hidden; }
        .info-header { padding: 12px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: bold; font-size: 15px; display: flex; justify-content: space-between; align-items: center;}
        .text-slide { padding: 15px; font-size: 13px; line-height: 1.6; }
        .info-row { margin-bottom: 5px; }
        .info-label { font-weight: bold; margin-right: 5px; }
        
        /* ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn-common { flex: 1; padding: 10px 0; border-radius: 6px; font-size: 12px; font-weight: bold; border: none; cursor: pointer; text-decoration: none; text-align: center; display: inline-block;}
        .btn-find { background-color: #FEE500; color: #000; }
        .btn-3d { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }

        /* 4. ğŸ”´ 3D ì‹œë„¤ë§ˆ ëª¨ë‹¬ (Iframe ë°©ì‹ - ì•ˆì •ì„± ìµœìš°ì„ ) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); z-index: 9999; display: none; 
            flex-direction: column; justify-content: center; align-items: center;
        }
        .modal-overlay.show { display: flex; }
        .modal-content { width: 100%; height: 100%; position: relative; }

        /* ë‹«ê¸° ë²„íŠ¼ */
        .close-btn {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            color: white; font-size: 30px; cursor: pointer; background: rgba(0,0,0,0.5);
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; justify-content: center;
        }

        /* ì•„ì´í”„ë ˆì„ (í™”ë©´ ê½‰ ì°¨ê²Œ) */
        iframe#lumaFrame { width: 100%; height: 100%; border: none; background: #000; }

        /* í•˜ë‹¨ ì„¹ì…˜ ë²„íŠ¼ */
        .section-buttons {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px; z-index: 100; background: rgba(0,0,0,0.6);
            padding: 8px; border-radius: 30px; flex-wrap: wrap; justify-content: center; width: 90%; max-width: 600px;
        }
        .sec-btn {
            padding: 8px 16px; background: rgba(255,255,255,0.1); color: white;
            border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; cursor: pointer; font-size: 13px;
        }
        .sec-btn.active { background: #6c5ce7; border-color: #6c5ce7; font-weight: bold; box-shadow: 0 0 10px #6c5ce7; }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media screen and (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { position:static; width: 100%; height: 40%; border-radius: 0; }
            #map { height: 60%; }
            .section-buttons { bottom: 15px; width: 95%; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="map"></div>
        <div class="sidebar">
            <div class="search-box"><input type="text" id="searchInput" class="search-input" placeholder="ì§€ì—­ëª… ê²€ìƒ‰ (ì˜ˆ: ëšì„¬, ì€í‰)"></div>
            <ul class="park-list" id="parkList"></ul>
        </div>
    </div>

    <div id="lumaModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">âœ•</button>
            <iframe id="lumaFrame" src="" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe>
            <div id="sectionBtnContainer" class="section-buttons"></div>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9dca9728dc03540c74a0fdd9c0e84c56&libraries=services"></script>

    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = { center: new kakao.maps.LatLng(37.5986261, 127.0922478), level: 8 }; 
        var map = new kakao.maps.Map(mapContainer, mapOption); 
        
        // ë§ˆì»¤ ì´ë¯¸ì§€ ì„¤ì • (ìŠ¤íŠ¸ë¦¿=íŒŒë‘, íŒŒí¬=ë¹¨ê°•)
        var imageSize = new kakao.maps.Size(30, 30); 
        var imageOption = {offset: new kakao.maps.Point(17, 35)}; 
        var redMarkerImg = new kakao.maps.MarkerImage("./park.png", imageSize, imageOption);
        var blueMarkerImg = new kakao.maps.MarkerImage("./street.png", imageSize, imageOption);

        // ğŸ”´ ì „ì²´ íŒŒí¬ ë°ì´í„°
        var skateParks = [
            // 1. ë””ë””ë¯¸ (3D ê¸°ëŠ¥ ë³´ìœ )
            { 
                title: "ë””ë””ë¯¸ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", 
                type: "street", addr: "ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬", 
                lat: 37.5784979, lng: 127.0347585, 
                level: "ì¤‘ê¸‰", levelClass: "medium", 
                hours: "09:00-23:00", 
                desc: "ì •ë¦‰ì²œë³€, 3D ë¶„ì„ ì™„ë£Œ! ë²„íŠ¼ì„ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.", 
                // ğŸ‘‡ [ì¤‘ìš”] ì—¬ê¸°ì— ë‹˜ì˜ capture ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš”.
                lumaSections: [
                    { name: "â‘  ìŠ¤íŠ¸ë¦¿", url: "https://lumalabs.ai/capture/323cd2c1-7df9-4095-bd49-86d8c5496773" },
                    { name: "â‘¡ ì¿¼í„° íŒŒì´í”„", url: "https://lumalabs.ai/capture/556d0432-15a6-4f21-8526-93125a5e27cf" },
                    { name: "â‘¢ ë©”ì¸ íŒŒí¬", url: "https://lumalabs.ai/capture/481b5834-750c-460d-90b9-e907776c5b84" }
                     ],
                images: ["./dedimi1.jpg"] 
            },
            // 2. ë‚˜ë¨¸ì§€ íŒŒí¬ ë°ì´í„°
            { title: "ë§ìš°ì—­ ê´‘ì¥", type: "park", addr: "ì¤‘ë‘êµ¬ ë§ìš°ë™", lat: 37.5986261, lng: 127.0922478, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "24ì‹œê°„", desc: "ì—­ ì• ëŒ€ë¦¬ì„ ê´‘ì¥.", images: ["./mangu1.jpg"] },
            { title: "í›ˆë ¨ì› ê³µì›", type: "park", addr: "ì¤‘êµ¬ ì„ì§€ë¡œ", lat: 37.567475, lng: 127.004690, level: "ìƒê¸‰", levelClass: "hard", hours: "08-20ì‹œ", desc: "ìŠ¤íŠ¸ë¦¿ ì„±ì§€, ëŒ€ë¦¬ì„ íƒ€ì¼ ë°”ë‹¥", images: ["./culti1.jpg"] },
            { title: "ì‚´ê³¶ì´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì‚¬ê·¼ë™", lat: 37.553866, lng: 127.046971, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08-23ì‹œ", desc: "23ì‹œ ì†Œë“±, í‰ì§€ ê³µê°„ í˜‘ì†Œ.", images: ["./salgoji1.jpg"] },
            { title: "ì„œìš¸ìˆ² ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì„±ìˆ˜ë™", lat: 37.5457255, lng: 127.0422293, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08-22ì‹œ", desc: "ìˆ²ì† ê°ì„±. ë°”ë‹¥ ì•ˆ ì¢‹ìŒ", images: ["./seoulforest1.jpg"] },
            { title: "ì´ì´Œ í•œê°•ê³µì›", type: "park", addr: "ìš©ì‚°êµ¬ ì´ì´Œë™", lat: 37.5193588, lng: 126.9661931, level: "ì´ˆê¸‰", levelClass: "easy", hours: "24ì‹œê°„", desc: "ë‹¤ë¦¬ ë°‘ ê·¸ëŠ˜. ë°”ë‹¥ ë¶€ë“œëŸ¬ì›€.", images: ["./ichon1.jpg"] },
            { title: "ê´‘ë‚˜ë£¨ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ê°•ë™êµ¬ ì•”ì‚¬ë™", lat: 37.5395428, lng: 127.114726, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "24ì‹œê°„", desc: "ë…¸ë€ ê¸°ë¬¼, ë°”ë‹¥ ë§¤ìš° ë§¤ë„ëŸ¬ì›€.", images: ["./gwangnaru1.jpg"] },
            { title: "ë…¸í•´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ë…¸ì›êµ¬ ìƒê³„ë™", lat: 37.6484306, lng: 127.0704715, level: "ìƒê¸‰", levelClass: "hard", hours: "09-22ì‹œ", desc: "ì˜¬ë¦¼í”½ ê·œê²©. ë³´ìš¸(Bowl) ë³´ìœ .", images: ["./nohae1.png"] },
            { title: "ëšì„¬ í•œê°•ê³µì›", type: "park", addr: "ê´‘ì§„êµ¬ ìì–‘ë™", lat: 37.529235, lng: 127.069562, level: "ìƒê¸‰", levelClass: "hard", hours: "24ì‹œê°„", desc: "ì„œìš¸ ìµœëŒ€ ê·œëª¨ íŒŒí¬", images: ["./ttukseom1.jpg"] },
            { title: "ë‚œì§€ ìµìŠ¤íŠ¸ë¦¼ì¥", type: "park", addr: "ë§ˆí¬êµ¬ ìƒì•”ë™", lat: 37.568461, lng: 126.874672, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "09-18ì‹œ", desc: "í•˜í”„íŒŒì´í”„ ë³´ìœ .", images: ["./nanji1.jpg"] },
            { title: "ë³´ë¼ë§¤ê³µì›", type: "park", addr: "ë™ì‘êµ¬ ì‹ ëŒ€ë°©ë™", lat: 37.4908333, lng:126.9218189 , level: "ì´ˆê¸‰", levelClass: "easy", hours: "06-22ì‹œ", desc: "ëŒ€íšŒ ì½”ìŠ¤ êµ¬ì„±, í—¬ë©§ í•„ìˆ˜.", images: ["./boramae1.png"] },
            { title: "ìµìŠ¤íŠ¸ë¦¼ ì€í‰", type: "park", addr: "ì€í‰êµ¬ ì§„ê´€ë™", lat: 37.638671, lng: 126.9172385, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "12:00-19:00", desc: "ì€í‰êµ¬ ìµœì´ˆ ì „ìš© íŒŒí¬.", images: ["./eunpyeong1.jpg"] }
        ];

        var markers = [];
        var infowindows = [];

        renderList(skateParks);
        createMarkers(skateParks);

        // ğŸŸ¢ 3D ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ (URL ì•ˆì „ ë³€í™˜)
        window.openLumaModal = function(index) {
            var data = skateParks[index];
            if(!data.lumaSections) { alert("3D ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!"); return; }

            var modal = document.getElementById('lumaModal');
            var btnContainer = document.getElementById('sectionBtnContainer');
            var frame = document.getElementById('lumaFrame');
            
            btnContainer.innerHTML = '';
            data.lumaSections.forEach((sec, i) => {
                var btn = document.createElement('button');
                btn.className = 'sec-btn';
                if(i === 0) btn.classList.add('active'); 
                btn.innerText = sec.name;
                btn.onclick = function() {
                    loadLumaSafe(frame, sec.url);
                    document.querySelectorAll('.sec-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                };
                btnContainer.appendChild(btn);
            });

            loadLumaSafe(frame, data.lumaSections[0].url);
            modal.classList.add('show');
        }

        window.closeModal = function() {
            document.getElementById('lumaModal').classList.remove('show');
            document.getElementById('lumaFrame').src = '';
        }

        // ğŸŸ¢ ì•ˆì „í•œ ë¡œë”© í•¨ìˆ˜ (Iframeìš© ì£¼ì†Œ ìë™ ë³€í™˜)
        function loadLumaSafe(frame, originalUrl) {
            var embedUrl = originalUrl.replace("capture", "embed");
            // í™”ì§ˆ ì˜µì…˜(sparkles) ê°•ì œ ì ìš©
            var separator = embedUrl.includes("?") ? "&" : "?";
            frame.src = embedUrl + separator + "mode=sparkles&background=%23000000&autoLoad=true";
        }

        function renderList(data) {
            var listEl = document.getElementById('parkList');
            listEl.innerHTML = ''; 
            data.forEach(function(item) {
                var li = document.createElement('li');
                li.className = 'park-item';
                var badge3D = (item.lumaSections) ? '<span style="color:#6c5ce7; font-weight:bold;"> [ğŸ§Š3D]</span>' : '';
                li.innerHTML = `<span class="item-title">${item.title} <span class="badge ${item.levelClass}">${item.level}</span>${badge3D}</span><span class="item-desc">${item.addr}</span>`;
                li.onclick = function() { 
                    var moveLatLon = new kakao.maps.LatLng(item.lat, item.lng);
                    map.panTo(moveLatLon);
                };
                listEl.appendChild(li);
            });
        }

        function createMarkers(data) {
            data.forEach(function(data, index) {
                // íƒ€ì…ì— ë”°ë¼ ë§ˆì»¤ ìƒ‰ìƒ ë³€ê²½
                var currentImage = (data.type === 'street') ? blueMarkerImg : redMarkerImg;
                var marker = new kakao.maps.Marker({
                    map: map, position: new kakao.maps.LatLng(data.lat, data.lng), image: currentImage
                });
                
                var btnHtml = `<div class="btn-group">
                                <a href="https://map.kakao.com/link/to/${data.title},${data.lat},${data.lng}" target="_blank" class="btn-common btn-find">ğŸš€ ê¸¸ì°¾ê¸°</a>`;
                if(data.lumaSections) {
                    btnHtml += `<button class="btn-common btn-3d" onclick="openLumaModal(${index})">ğŸ§Š 3D ì‹œë„¤ë§ˆ</button>`;
                }
                btnHtml += `</div>`;

                var content = `<div class="wrap"><div class="info-header"><span class="info-title">${data.title}</span><span class="badge ${data.levelClass}">${data.level}</span></div><div class="text-slide"><div class="info-row"><span class="info-label">â°</span>${data.hours}</div><div class="info-row"><span class="info-label">ğŸ“</span>${data.desc}</div>${btnHtml}</div></div>`;
                var infowindow = new kakao.maps.InfoWindow({ content: content, removable: true });
                infowindows.push(infowindow);

                kakao.maps.event.addListener(marker, 'click', function() {
                    for(var i=0; i<infowindows.length; i++) infowindows[i].close();
                    infowindow.open(map, marker);
                });
            });
        }
        
        // ê²€ìƒ‰ ê¸°ëŠ¥
        var searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('keyup', function(e) {
            if(e.key === 'Enter') { 
                var keyword = this.value.trim();
                var filtered = skateParks.filter(function(item) {
                    return item.title.includes(keyword) || item.addr.includes(keyword);
                });
                renderList(filtered);
            }
        });
    </script>
</body>
</html>