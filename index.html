<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ì‹œ ìŠ¤ì¼€ì´íŠ¸ë³´ë“œ íŒŒí¬ ì§€ë„</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <style>
        /* 1. ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif;}
        
        /* 2. ë ˆì´ì•„ì›ƒ */
        .container { position: relative; width: 100%; height: 100%; }
        #map { width: 100%; height: 100%; }

        /* 3. ì‚¬ì´ë“œë°” (í”Œë¡œíŒ… UI) */
        .sidebar {
            position: absolute; top: 15px; left: 15px; bottom: 15px; width: 360px;
            background: rgba(255, 255, 255, 0.95); z-index: 20; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border-radius: 12px; display: flex; flex-direction: column; overflow: hidden;
        }
        .search-box { padding: 15px; border-bottom: 1px solid #eee; background: transparent; }
        .search-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .filter-box { padding: 10px 15px; display: flex; gap: 8px; border-bottom: 1px solid #eee; }
        .filter-btn { flex: 1; padding: 8px 0; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; color: #555; transition: all 0.2s; }
        .filter-btn:hover { background: #f1f1f1; }
        .filter-btn.active { background: #333; color: white; border-color: #333; }
        
        .park-list { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        .park-list::-webkit-scrollbar { width: 6px; }
        .park-list::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 3px; }
        
        .park-item { padding: 18px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.2s; }
        .park-item:hover { background: #f1f8ff; }
        .item-title { font-weight: bold; font-size: 15px; margin-bottom: 6px; display: block; color: #222; }
        .item-desc { font-size: 13px; color: #777; display: block; line-height: 1.4; }
        
        .no-result { padding: 40px 20px; text-align: center; color: #999; font-size: 14px; }
        .recommend-msg { padding: 15px; background: #e8f5e9; color: #2e7d32; font-size: 13px; font-weight: bold; border-bottom: 1px solid #c8e6c9; line-height: 1.4; }
        
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; color: white; font-weight: bold; display: inline-block; margin-left: 6px; vertical-align: middle;}
        .hard { background-color: #ff4757; } .medium { background-color: #ffa502; } .easy { background-color: #2ed573; }   

        /* ì •ë³´ì°½ ë””ìì¸ */
        .wrap { padding: 0; width: 280px; background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); overflow: hidden; }
        .info-header { padding: 12px; display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; border-bottom: 1px solid #eee; height: 35px; }
        .info-title { font-weight: bold; font-size: 15px; color: #333; margin: 0; }
        .slider-container { position: relative; width: 100%; height: 160px; background: #fff; }
        
        /* 3D ë·°ì–´ */
        model-viewer { width: 100%; height: 100%; background-color: #eee; }

        .slide-item { width: 100%; height: 100%; display: none; }
        .slide-item.active { display: block; }
        .text-slide { padding: 15px 20px; box-sizing: border-box; background-color: #fff; color: #333; overflow-y: auto; display: flex; flex-direction: column; justify-content: center; display: none; }
        .text-slide.active { display: flex; }
        .info-row { font-size: 13px; margin-bottom: 6px; line-height: 1.5; }
        .info-label { font-weight: bold; color: #333; margin-right: 5px; }
        
        /* ê¸¸ì°¾ê¸° ë²„íŠ¼ */
        .btn-find-way { display: block; width: 100%; padding: 10px 0; margin-top: 10px; background-color: #FEE500; color: #000; text-align: center; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 13px; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-find-way:hover { background-color: #fdd835; }

        .img-slide { object-fit: cover; }
        .prev-btn, .next-btn { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(255,255,255,0.7); color: #333; border: none; padding: 10px; cursor: pointer; font-size: 18px; z-index: 10; border-radius: 50%; width: 35px; height: 35px; display:flex; align-items:center; justify-content:center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);}
        .prev-btn:hover, .next-btn:hover { background-color: white; color: black;}
        .prev-btn { left: 10px; } .next-btn { right: 10px; }
        .page-indicator { position: absolute; bottom: 8px; right: 10px; font-size: 10px; color: #666; background: rgba(255,255,255,0.9); padding: 3px 6px; border-radius: 10px; z-index: 20; box-shadow: 0 1px 3px rgba(0,0,0,0.1);}

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media screen and (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { top: auto; left: 10px; right: 10px; bottom: 10px; width: auto; height: 40%; border-radius: 15px; }
            #map { height: 100%; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="map"></div>

        <div class="sidebar">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="ì§€ì—­ëª…(ê°•ë‚¨, í™ëŒ€) ì…ë ¥ í›„ ì—”í„°!">
            </div>
            <div class="filter-box">
                <button class="filter-btn active" onclick="filterList('all')">ì „ì²´</button>
                <button class="filter-btn" onclick="filterList('easy')">ì´ˆê¸‰</button>
                <button class="filter-btn" onclick="filterList('medium')">ì¤‘ê¸‰</button>
                <button class="filter-btn" onclick="filterList('hard')">ìƒê¸‰</button>
            </div>
            <div id="recommendMsg" class="recommend-msg" style="display:none;"></div>
            <ul class="park-list" id="parkList"></ul>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9dca9728dc03540c74a0fdd9c0e84c56&libraries=services"></script>

    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = { center: new kakao.maps.LatLng(37.5986261, 127.0922478), level: 8 }; 
        var map = new kakao.maps.Map(mapContainer, mapOption); 
        var ps = new kakao.maps.services.Places();

        // ì¤Œ ì»¨íŠ¸ë¡¤ ì¶”ê°€
        var zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

        // â–¼â–¼â–¼ 2. ë§ˆì»¤ ì´ë¯¸ì§€ ì„¤ì • (ë‚´ ì»´í“¨í„° íŒŒì¼ ì‚¬ìš©) â–¼â–¼â–¼
        // íŒŒì¼ëª…ì´ 'markerRed.png', 'markerBlue.png' ì™€ ì •í™•íˆ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.
        var markerRedUrl = "./park.png"; 
        var markerBlueUrl = "./street.png";
        
        // ë§ˆì»¤ í¬ê¸° ì„¤ì • (ì›ë³¸ ì´ë¯¸ì§€ê°€ í¬ë©´ ì—¬ê¸°ì„œ ìˆ«ìë¥¼ ì¤„ì´ì„¸ìš”! ì˜ˆ: 32, 32)
        var imageSize = new kakao.maps.Size(30, 30); 
        var imageOption = {offset: new kakao.maps.Point(17, 35)}; 

        // ë§ˆì»¤ ê°ì²´ ìƒì„±
        var redMarkerImg = new kakao.maps.MarkerImage(markerRedUrl, imageSize, imageOption);
        var blueMarkerImg = new kakao.maps.MarkerImage(markerBlueUrl, imageSize, imageOption);

        // ë°ì´í„° ë¦¬ìŠ¤íŠ¸
        var skateParks = [
            { 
                title: "ë§ìš°ì—­ ê´‘ì¥ (ìŠ¤íŒŸ)", 
                type: "street", // ğŸ”µ íŒŒë€ í•€ ì ìš©
                addr: "ì¤‘ë‘êµ¬ ë§ìš°ë™", 
                lat: 37.5986261, lng: 127.0922478, 
                level: "ì¤‘ê¸‰", levelClass: "medium", 
                hours: "24ì‹œê°„", 
                desc: "ì—­ ì• ëŒ€ë¦¬ì„ ê´‘ì¥. ë°”ë‹¥ì´ ë§¤ë„ëŸ¬ì›€.", 
                images: ["./mangu1.jpg"] 
            },
            { title: "í›ˆë ¨ì› ê³µì›", type: "park", addr: "ì¤‘êµ¬ ì„ì§€ë¡œ", lat: 37.567475, lng: 127.004690, level: "ìƒê¸‰", levelClass: "hard", hours: "08:00-20:00", desc: "ìŠ¤íŠ¸ë¦¿ ì„±ì§€, ëŒ€ë¦¬ì„ íƒ€ì¼ ë°”ë‹¥", images: ["./culti1.jpg"] },
            { title: "ì‚´ê³¶ì´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì‚¬ê·¼ë™", lat: 37.553866, lng: 127.046971, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08:00-23:00", desc: "23ì‹œ ì†Œë“±, í‰ì§€ ê³µê°„ í˜‘ì†Œ.", images: ["./salgoji1.jpg"] },
            { title: "ì„œìš¸ìˆ² ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì„±ìˆ˜ë™", lat: 37.5457255, lng: 127.0422293, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08:00-22:00", desc: "ìˆ²ì† ê°ì„±. ë°”ë‹¥ ì•ˆ ì¢‹ìŒ", images: ["./seoulforest1.jpg"] },
            { title: "ì´ì´Œ í•œê°•ê³µì›", type: "park", addr: "ìš©ì‚°êµ¬ ì´ì´Œë™", lat: 37.5193588, lng: 126.9661931, level: "ì´ˆê¸‰", levelClass: "easy", hours: "24ì‹œê°„", desc: "ë‹¤ë¦¬ ë°‘ ê·¸ëŠ˜. ë°”ë‹¥ ë¶€ë“œëŸ¬ì›€.", images: ["./ichon1.jpg"] },
            { title: "ê´‘ë‚˜ë£¨ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ê°•ë™êµ¬ ì•”ì‚¬ë™", lat: 37.5395428, lng: 127.114726, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "24ì‹œê°„", desc: "ë…¸ë€ ê¸°ë¬¼, ë°”ë‹¥ ë§¤ìš° ë§¤ë„ëŸ¬ì›€.", images: ["./gwangnaru1.jpg"] },
            { title: "ë…¸í•´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ë…¸ì›êµ¬ ìƒê³„ë™", lat: 37.6484306, lng: 127.0704715, level: "ìƒê¸‰", levelClass: "hard", hours: "09-22ì‹œ", desc: "ì˜¬ë¦¼í”½ ê·œê²©. ë³´ìš¸(Bowl) ë³´ìœ .", images: ["./nohae1.png","./nohae2.jpg"] },
            { title: "ëšì„¬ í•œê°•ê³µì›", type: "park", addr: "ê´‘ì§„êµ¬ ìì–‘ë™", lat: 37.529235, lng: 127.069562, level: "ìƒê¸‰", levelClass: "hard", hours: "24ì‹œê°„", desc: "ì„œìš¸ ìµœëŒ€ ê·œëª¨ íŒŒí¬", images: ["./ttukseom1.jpg"] },
            { title: "ë‚œì§€ ìµìŠ¤íŠ¸ë¦¼ì¥", type: "park", addr: "ë§ˆí¬êµ¬ ìƒì•”ë™", lat: 37.568461, lng: 126.874672, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "09-18ì‹œ", desc: "í•˜í”„íŒŒì´í”„ ë³´ìœ .", images: ["./nanji1.jpg"] },
            { title: "ë³´ë¼ë§¤ê³µì›", type: "park", addr: "ë™ì‘êµ¬ ì‹ ëŒ€ë°©ë™", lat: 37.4908333, lng:126.9218189 , level: "ì´ˆê¸‰", levelClass: "easy", hours: "06-22ì‹œ", desc: "ëŒ€íšŒ ì½”ìŠ¤ êµ¬ì„±, í—¬ë©§ í•„ìˆ˜.", images: ["./boramae1.png","./boramae2.png","./boramae3.png","./boramae4.png"] },
            { title: "ë””ë””ë¯¸ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬", lat: 37.5784979, lng: 127.0347585, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "09:00-23:00", desc: "ì •ë¦‰ì²œë³€ ë‹¤ë¦¬ë°‘ì— ìœ„ì¹˜, ìš°ì²œ ì‹œ ë²”ëŒ ì£¼ì˜", images: ["./dedimi1.jpg"] },
            { title: "ìµìŠ¤íŠ¸ë¦¼ ì€í‰", type: "park", addr: "ì€í‰êµ¬ ì§„ê´€ë™", lat: 37.638671, lng: 126.9172385, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "12:00-19:00 (ì›” íœ´ë¬´)", desc: "ì€í‰êµ¬ ìµœì´ˆ ì „ìš© íŒŒí¬. ì¸ê³µì•”ë²½ì¥ ì˜†.", images: ["./eunpyeong1.jpg"] }
        ];

        var markers = [];
        var infowindows = [];

        renderList(skateParks);
        createMarkers(skateParks);

        function renderList(data, recommendText) {
            var listEl = document.getElementById('parkList');
            var msgEl = document.getElementById('recommendMsg');
            listEl.innerHTML = ''; 

            if(recommendText) {
                msgEl.style.display = 'block';
                msgEl.innerHTML = recommendText;
            } else {
                msgEl.style.display = 'none';
            }

            if (data.length === 0) {
                listEl.innerHTML = '<li class="no-result">ê²°ê³¼ê°€ ì—†ì–´ì„œ<br>ê°€ì¥ ê°€ê¹Œìš´ ê³³ì„ ì°¾ëŠ” ì¤‘...ğŸ¤”</li>';
                return;
            }

            data.forEach(function(item, index) {
                var li = document.createElement('li');
                li.className = 'park-item';
                var distStr = item.distance ? `<br><span style="color:#2e7d32; font-weight:bold;">ğŸ“ ê±°ë¦¬: ì•½ ${item.distance}km</span>` : '';
                
                li.innerHTML = `
                    <span class="item-title">${item.title} <span class="badge ${item.levelClass}">${item.level}</span></span>
                    <span class="item-desc">${item.addr} | ${item.desc}${distStr}</span>
                `;
                li.onclick = function() { moveToPark(item.lat, item.lng); };
                listEl.appendChild(li);
            });
        }

        function createMarkers(data) {
            for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }
            markers = [];
            infowindows = [];

            data.forEach(function(data, index) {
                // ğŸ”´ typeì´ 'street'ë©´ íŒŒë€ í•€, ì•„ë‹ˆë©´ ë¹¨ê°„ í•€ ì‚¬ìš©
                var currentImage = (data.type === 'street') ? blueMarkerImg : redMarkerImg;

                var marker = new kakao.maps.Marker({
                    map: map, position: new kakao.maps.LatLng(data.lat, data.lng), image: currentImage
                });
                markers.push(marker);

                var slidesHtml = `
                    <div class="slide-item text-slide active">
                        <div class="info-row"><span class="info-label">â°</span>${data.hours}</div>
                        <div class="info-row"><span class="info-label">ğŸ“</span>${data.desc}</div>
                        <a href="https://map.kakao.com/link/to/${data.title},${data.lat},${data.lng}" target="_blank" class="btn-find-way">ğŸš€ ì¹´ì¹´ì˜¤ë§µ ê¸¸ì°¾ê¸°</a>
                    </div>
                `;

                var hasModel = false;
                if(data.model3d) {
                    slidesHtml += `
                        <div class="slide-item">
                            <model-viewer src="${data.model3d}" auto-rotate camera-controls shadow-intensity="1" alt="3D Model"></model-viewer>
                            <div style="position:absolute; bottom:5px; left:0; width:100%; text-align:center; font-size:11px; color:#555; pointer-events:none;">ğŸ‘† ë§ˆìš°ìŠ¤ë¡œ ëŒë ¤ë³´ì„¸ìš”</div>
                        </div>
                    `;
                    hasModel = true;
                }

                if(data.images && data.images.length > 0) {
                    for(var j=0; j<data.images.length; j++) {
                        slidesHtml += `<img src="${data.images[j]}" class="slide-item img-slide">`;
                    }
                }
                
                var totalPages = 1 + (hasModel ? 1 : 0) + (data.images ? data.images.length : 0);
                var content = `<div class="wrap"><div class="info-header"><span class="info-title">${data.title}</span><span class="badge ${data.levelClass}">${data.level}</span></div><div class="slider-container"><button class="prev-btn" onclick="moveSlide(this, -1)">â®</button><div class="slides">${slidesHtml}</div><button class="next-btn" onclick="moveSlide(this, 1)">â¯</button><div class="page-indicator">1 / ${totalPages}</div></div></div>`;
                var infowindow = new kakao.maps.InfoWindow({ content: content, removable: true });
                infowindows.push(infowindow);

                // í´ë¦­ ì‹œ í™•ëŒ€ ë° ì´ë™
                kakao.maps.event.addListener(marker, 'click', function() {
                    closeAllInfowindows();
                    map.setLevel(4, {animate: true});
                    map.panTo(marker.getPosition());
                    infowindow.open(map, marker);
                });
            });
        }

        function moveToPark(lat, lng) {
            var moveLatLon = new kakao.maps.LatLng(lat, lng);
            map.setLevel(4, {animate: true});
            map.panTo(moveLatLon);
            closeAllInfowindows();
            var targetMarker = markers.find(function(m) { return m.getPosition().getLat().toFixed(6) == lat.toString() && m.getPosition().getLng().toFixed(6) == lng.toString(); });
            if(targetMarker) { 
                var realIndex = skateParks.findIndex(function(p) { return p.lat === lat && p.lng === lng; });
                if(realIndex >= 0 && infowindows[realIndex]) infowindows[realIndex].open(map, targetMarker);
            }
        }
        function closeAllInfowindows() { for(var i=0; i<infowindows.length; i++) { infowindows[i].close(); } }

        var searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('keyup', function(e) {
            if(e.key === 'Enter') { searchLocation(); return; }
            var keyword = this.value.trim();
            if(!keyword) { renderList(skateParks); return; }
            var filtered = skateParks.filter(function(item) {
                return item.title.includes(keyword) || item.addr.includes(keyword);
            });
            renderList(filtered);
        });

        function searchLocation() {
            var keyword = searchInput.value.trim();
            if (!keyword) return;
            var textMatch = skateParks.filter(item => item.title.includes(keyword) || item.addr.includes(keyword));
            if(textMatch.length > 0) { renderList(textMatch); return; }

            ps.keywordSearch(keyword, function(data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    var centerLat = data[0].y;
                    var centerLng = data[0].x;
                    var sortedParks = skateParks.map(function(park) {
                        var dist = getDistanceFromLatLonInKm(centerLat, centerLng, park.lat, park.lng);
                        return { ...park, distance: dist.toFixed(1) }; 
                    }).sort(function(a, b) { return a.distance - b.distance; });
                    var nearest = [sortedParks[0]]; 
                    var moveLatLon = new kakao.maps.LatLng(centerLat, centerLng);
                    map.panTo(moveLatLon);
                    renderList(nearest, `ğŸ“¢ '${keyword}' ì£¼ë³€ì—” ì—†ë„¤ìš”.<br>ëŒ€ì‹  ê°€ì¥ ê°€ê¹Œìš´ ê³³ì„ ì°¾ì•˜ì–´ìš”!`);
                } else {
                    document.getElementById('parkList').innerHTML = '<li class="no-result">ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¢</li>';
                }
            });
        }

        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
            var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); return R * c; 
        }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        function filterList(type) {
            var btns = document.querySelectorAll('.filter-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('recommendMsg').style.display = 'none';
            if(type === 'all') { renderList(skateParks); } 
            else { renderList(skateParks.filter(function(item) { return item.levelClass === type; })); }
        }

        window.moveSlide = function(btn, direction) {
            var container = btn.parentElement;
            var items = container.querySelectorAll('.slide-item');
            var indicator = container.querySelector('.page-indicator');
            var currentIndex = 0;
            for(var i=0; i<items.length; i++) { if(items[i].classList.contains('active')) { currentIndex = i; break; } }
            items[currentIndex].classList.remove('active');
            var nextIndex = currentIndex + direction;
            if (nextIndex >= items.length) nextIndex = 0; if (nextIndex < 0) nextIndex = items.length - 1;
            items[nextIndex].classList.add('active');
            if(indicator) indicator.innerText = (nextIndex + 1) + " / " + items.length;
        }
    </script>
</body>
</html>