<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ì‹œ ìŠ¤ì¼€ì´íŠ¸ë³´ë“œ íŒŒí¬ ì§€ë„</title>
    
    <script type="module" src="https://unpkg.com/@lumaai/luma-web"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif;}
        .container { position: relative; width: 100%; height: 100%; }
        #map { width: 100%; height: 100%; }

        /* ì‚¬ì´ë“œë°” */
        .sidebar { position: absolute; top: 15px; left: 15px; bottom: 15px; width: 360px; background: rgba(255, 255, 255, 0.95); z-index: 20; box-shadow: 0 5px 15px rgba(0,0,0,0.15); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .search-box { padding: 15px; border-bottom: 1px solid #eee; background: transparent; }
        .search-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; outline: none; }
        .filter-box { padding: 10px 15px; display: flex; gap: 8px; border-bottom: 1px solid #eee; }
        .filter-btn { flex: 1; padding: 8px 0; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; color: #555; transition: all 0.2s; }
        .filter-btn:hover { background: #f1f1f1; }
        .filter-btn.active { background: #333; color: white; border-color: #333; }
        .park-list { flex: 1; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        .park-item { padding: 18px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background 0.2s; }
        .park-item:hover { background: #f1f8ff; }
        .item-title { font-weight: bold; font-size: 15px; margin-bottom: 6px; display: block; color: #222; }
        .item-desc { font-size: 13px; color: #777; display: block; line-height: 1.4; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 11px; color: white; font-weight: bold; display: inline-block; margin-left: 6px; vertical-align: middle;}
        .hard { background-color: #ff4757; } .medium { background-color: #ffa502; } .easy { background-color: #2ed573; }
        
        /* ì •ë³´ì°½ ë””ìì¸ */
        .wrap { padding: 0; width: 280px; background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); overflow: hidden; }
        .info-header { padding: 12px; display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; border-bottom: 1px solid #eee; height: 35px; }
        .info-title { font-weight: bold; font-size: 15px; color: #333; margin: 0; }
        .slider-container { position: relative; width: 100%; height: 160px; background: #fff; }
        .text-slide { padding: 15px 20px; box-sizing: border-box; background-color: #fff; color: #333; overflow-y: auto; display: flex; flex-direction: column; justify-content: center; height: 100%; }
        .info-row { font-size: 13px; margin-bottom: 6px; line-height: 1.5; }
        
        /* ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .btn-common { flex: 1; padding: 10px 0; border-radius: 6px; font-size: 12px; font-weight: bold; border: none; cursor: pointer; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-find { background-color: #FEE500; color: #000; }
        /* ğŸ”µ Luma 3D ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-3d { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .btn-3d:hover { opacity: 0.9; }

        /* ğŸ”´ Luma ëª¨ë‹¬ì°½ (ì „ì²´í™”ë©´) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); z-index: 9999; display: none; 
            flex-direction: column; justify-content: center; align-items: center;
        }
        .modal-overlay.show { display: flex; }
        
        .modal-content { width: 100%; height: 100%; position: relative; }

        /* ë‹«ê¸° ë²„íŠ¼ */
        .close-btn {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            color: white; font-size: 30px; background: rgba(0,0,0,0.5); 
            border: 1px solid rgba(255,255,255,0.3); border-radius: 50%;
            width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        /* í•˜ë‹¨ ì„¹ì…˜ ì„ íƒ ë²„íŠ¼ë“¤ */
        .section-buttons {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px; z-index: 100; background: rgba(0,0,0,0.6);
            padding: 8px; border-radius: 30px; backdrop-filter: blur(5px); flex-wrap: wrap; justify-content: center; width: 90%; max-width: 600px;
        }
        .sec-btn {
            padding: 8px 16px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); color: white; border-radius: 20px;
            cursor: pointer; font-size: 13px; transition: all 0.3s; white-space: nowrap;
        }
        .sec-btn:hover { background: rgba(255,255,255,0.3); }
        .sec-btn.active { background: #6c5ce7; border-color: #6c5ce7; font-weight: bold; box-shadow: 0 0 10px #6c5ce7; }

        /* Luma ë·°ì–´ */
        luma-splat { width: 100%; height: 100%; }

        @media screen and (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { top: auto; left: 10px; right: 10px; bottom: 10px; width: auto; height: 35%; border-radius: 15px; }
            #map { height: 100%; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="map"></div>
        <div class="sidebar">
            <div class="search-box"><input type="text" id="searchInput" class="search-input" placeholder="ì§€ì—­ëª…(ê°•ë‚¨, í™ëŒ€) ì…ë ¥ í›„ ì—”í„°!"></div>
            <div class="filter-box">
                <button class="filter-btn active" onclick="filterList('all')">ì „ì²´</button>
                <button class="filter-btn" onclick="filterList('easy')">ì´ˆê¸‰</button>
                <button class="filter-btn" onclick="filterList('medium')">ì¤‘ê¸‰</button>
                <button class="filter-btn" onclick="filterList('hard')">ìƒê¸‰</button>
            </div>
            <ul class="park-list" id="parkList"></ul>
        </div>
    </div>

    <div id="lumaModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">âœ•</button>
            
            <luma-splat id="lumaViewer" source=""></luma-splat>

            <div id="sectionBtnContainer" class="section-buttons"></div>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9dca9728dc03540c74a0fdd9c0e84c56&libraries=services"></script>

    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = { center: new kakao.maps.LatLng(37.5986261, 127.0922478), level: 8 }; 
        var map = new kakao.maps.Map(mapContainer, mapOption); 
        var ps = new kakao.maps.services.Places();
        
        var markerRedUrl = "./park.png"; 
        var markerBlueUrl = "./street.png";
        var imageSize = new kakao.maps.Size(30, 30); 
        var imageOption = {offset: new kakao.maps.Point(17, 35)}; 
        var redMarkerImg = new kakao.maps.MarkerImage(markerRedUrl, imageSize, imageOption);
        var blueMarkerImg = new kakao.maps.MarkerImage(markerBlueUrl, imageSize, imageOption);

        // ğŸ”´ ëª¨ë“  íŒŒí¬ ë°ì´í„° ë³µêµ¬ë¨ + ë””ë””ë¯¸ Luma ì„¹ì…˜ ì¶”ê°€
        var skateParks = [
            { 
                title: "ë””ë””ë¯¸ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", 
                type: "park", 
                addr: "ë™ëŒ€ë¬¸êµ¬ ë‹µì‹­ë¦¬", 
                lat: 37.5784979, lng: 127.0347585, 
                level: "ì¤‘ê¸‰", levelClass: "medium", 
                hours: "09:00-23:00", 
                desc: "ì •ë¦‰ì²œë³€, 3D ë¶„ì„ ì™„ë£Œ! ë²„íŠ¼ì„ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.", 
                // ğŸ‘‡ [ì¤‘ìš”] ì—¬ê¸°ì— Luma URL 4ê°œë¥¼ ë„£ìœ¼ì„¸ìš”!
                lumaSections: [
                    { name: "â‘  ìŠ¤íŠ¸ë¦¿", url: "https://lumalabs.ai/capture/323cd2c1-7df9-4095-bd49-86d8c5496773" },
                    { name: "â‘¡ ë©”ì¸ íŒŒí¬", url: "https://lumalabs.ai/capture/481b5834-750c-460d-90b9-e907776c5b84" },
                    { name: "â‘¢ ì¿¼í„° íŒŒì´í”„", url: "https://lumalabs.ai/capture/556d0432-15a6-4f21-8526-93125a5e27cf" },
                    { name: "â‘£ ê³„ë‹¨ ìŠ¤íŒŸ", url: "https://lumalabs.ai/capture/481b5834-750c-460d-90b9-e907776c5b84" }
                ],
                images: ["./dedimi1.jpg"] 
            },
            { title: "ë§ìš°ì—­ ê´‘ì¥", type: "street", addr: "ì¤‘ë‘êµ¬ ë§ìš°ë™", lat: 37.5986261, lng: 127.0922478, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "24ì‹œê°„", desc: "ì—­ ì• ëŒ€ë¦¬ì„ ê´‘ì¥.", images: ["./mangu1.jpg"] },
            { title: "í›ˆë ¨ì› ê³µì›", type: "park", addr: "ì¤‘êµ¬ ì„ì§€ë¡œ", lat: 37.567475, lng: 127.004690, level: "ìƒê¸‰", levelClass: "hard", hours: "08-20ì‹œ", desc: "ìŠ¤íŠ¸ë¦¿ ì„±ì§€, ëŒ€ë¦¬ì„ íƒ€ì¼ ë°”ë‹¥", images: ["./culti1.jpg"] },
            { title: "ì‚´ê³¶ì´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì‚¬ê·¼ë™", lat: 37.553866, lng: 127.046971, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08-23ì‹œ", desc: "23ì‹œ ì†Œë“±, í‰ì§€ ê³µê°„ í˜‘ì†Œ.", images: ["./salgoji1.jpg"] },
            { title: "ì„œìš¸ìˆ² ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ì„±ë™êµ¬ ì„±ìˆ˜ë™", lat: 37.5457255, lng: 127.0422293, level: "ì´ˆ/ì¤‘ê¸‰", levelClass: "easy", hours: "08-22ì‹œ", desc: "ìˆ²ì† ê°ì„±. ë°”ë‹¥ ì•ˆ ì¢‹ìŒ", images: ["./seoulforest1.jpg"] },
            { title: "ì´ì´Œ í•œê°•ê³µì›", type: "park", addr: "ìš©ì‚°êµ¬ ì´ì´Œë™", lat: 37.5193588, lng: 126.9661931, level: "ì´ˆê¸‰", levelClass: "easy", hours: "24ì‹œê°„", desc: "ë‹¤ë¦¬ ë°‘ ê·¸ëŠ˜. ë°”ë‹¥ ë¶€ë“œëŸ¬ì›€.", images: ["./ichon1.jpg"] },
            { title: "ê´‘ë‚˜ë£¨ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ê°•ë™êµ¬ ì•”ì‚¬ë™", lat: 37.5395428, lng: 127.114726, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "24ì‹œê°„", desc: "ë…¸ë€ ê¸°ë¬¼, ë°”ë‹¥ ë§¤ìš° ë§¤ë„ëŸ¬ì›€.", images: ["./gwangnaru1.jpg"] },
            { title: "ë…¸í•´ ìŠ¤ì¼€ì´íŠ¸íŒŒí¬", type: "park", addr: "ë…¸ì›êµ¬ ìƒê³„ë™", lat: 37.6484306, lng: 127.0704715, level: "ìƒê¸‰", levelClass: "hard", hours: "09-22ì‹œ", desc: "ì˜¬ë¦¼í”½ ê·œê²©. ë³´ìš¸(Bowl) ë³´ìœ .", images: ["./nohae1.png"] },
            { title: "ëšì„¬ í•œê°•ê³µì›", type: "park", addr: "ê´‘ì§„êµ¬ ìì–‘ë™", lat: 37.529235, lng: 127.069562, level: "ìƒê¸‰", levelClass: "hard", hours: "24ì‹œê°„", desc: "ì„œìš¸ ìµœëŒ€ ê·œëª¨ íŒŒí¬", images: ["./ttukseom1.jpg"] },
            { title: "ë‚œì§€ ìµìŠ¤íŠ¸ë¦¼ì¥", type: "park", addr: "ë§ˆí¬êµ¬ ìƒì•”ë™", lat: 37.568461, lng: 126.874672, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "09-18ì‹œ", desc: "í•˜í”„íŒŒì´í”„ ë³´ìœ .", images: ["./nanji1.jpg"] },
            { title: "ë³´ë¼ë§¤ê³µì›", type: "park", addr: "ë™ì‘êµ¬ ì‹ ëŒ€ë°©ë™", lat: 37.4908333, lng:126.9218189 , level: "ì´ˆê¸‰", levelClass: "easy", hours: "06-22ì‹œ", desc: "ëŒ€íšŒ ì½”ìŠ¤ êµ¬ì„±, í—¬ë©§ í•„ìˆ˜.", images: ["./boramae1.png"] },
            { title: "ìµìŠ¤íŠ¸ë¦¼ ì€í‰", type: "park", addr: "ì€í‰êµ¬ ì§„ê´€ë™", lat: 37.638671, lng: 126.9172385, level: "ì¤‘ê¸‰", levelClass: "medium", hours: "12:00-19:00", desc: "ì€í‰êµ¬ ìµœì´ˆ ì „ìš© íŒŒí¬.", images: ["./eunpyeong1.jpg"] }
        ];

        var markers = [];
        var infowindows = [];

        renderList(skateParks);
        createMarkers(skateParks);

        // 3D ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
        window.openLumaModal = function(index) {
            var data = skateParks[index];
            if(!data.lumaSections || data.lumaSections.length === 0) {
                alert("ì•„ì§ 3D ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
                return;
            }

            var modal = document.getElementById('lumaModal');
            var btnContainer = document.getElementById('sectionBtnContainer');
            var viewer = document.getElementById('lumaViewer');
            
            btnContainer.innerHTML = '';
            data.lumaSections.forEach((sec, i) => {
                var btn = document.createElement('button');
                btn.className = 'sec-btn';
                if(i === 0) btn.classList.add('active'); 
                btn.innerText = sec.name;
                btn.onclick = function() {
                    viewer.setAttribute('source', sec.url);
                    document.querySelectorAll('.sec-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                };
                btnContainer.appendChild(btn);
            });

            viewer.setAttribute('source', data.lumaSections[0].url);
            modal.classList.add('show');
        }

        window.closeModal = function() {
            document.getElementById('lumaModal').classList.remove('show');
            document.getElementById('lumaViewer').setAttribute('source', '');
        }

        function renderList(data) {
            var listEl = document.getElementById('parkList');
            listEl.innerHTML = ''; 
            if (data.length === 0) { listEl.innerHTML = '<li class="no-result">ê²°ê³¼ê°€ ì—†ë„¤ìš” ğŸ˜¢</li>'; return; }

            data.forEach(function(item) {
                var li = document.createElement('li');
                li.className = 'park-item';
                var badge3D = (item.lumaSections) ? '<span style="color:#6c5ce7; font-weight:bold; font-size:11px;"> [ğŸ§Š3D]</span>' : '';
                li.innerHTML = `<span class="item-title">${item.title} <span class="badge ${item.levelClass}">${item.level}</span>${badge3D}</span><span class="item-desc">${item.addr} | ${item.desc}</span>`;
                li.onclick = function() { moveToPark(item.lat, item.lng); };
                listEl.appendChild(li);
            });
        }

        function createMarkers(data) {
            for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }
            markers = []; infowindows = [];

            data.forEach(function(data) {
                var currentImage = (data.type === 'street') ? blueMarkerImg : redMarkerImg;
                var marker = new kakao.maps.Marker({
                    map: map, position: new kakao.maps.LatLng(data.lat, data.lng), image: currentImage
                });
                markers.push(marker);
                
                var originalIndex = skateParks.indexOf(data);
                
                // ì •ë³´ì°½ì— 3D ë²„íŠ¼ ì¶”ê°€
                var btnHtml = `<div class="btn-group">
                                    <a href="https://map.kakao.com/link/to/${data.title},${data.lat},${data.lng}" target="_blank" class="btn-common btn-find">ğŸš€ ê¸¸ì°¾ê¸°</a>`;
                if(data.lumaSections) {
                    btnHtml += `<button class="btn-common btn-3d" onclick="openLumaModal(${originalIndex})">ğŸ§Š 3D ì‹œë„¤ë§ˆ</button>`;
                }
                btnHtml += `</div>`;

                var content = `<div class="wrap"><div class="info-header"><span class="info-title">${data.title}</span><span class="badge ${data.levelClass}">${data.level}</span></div><div class="slider-container"><div class="text-slide"><div class="info-row"><span class="info-label">â°</span>${data.hours}</div><div class="info-row"><span class="info-label">ğŸ“</span>${data.desc}</div>${btnHtml}</div></div></div>`;

                var infowindow = new kakao.maps.InfoWindow({ content: content, removable: true });
                infowindows.push(infowindow);

                kakao.maps.event.addListener(marker, 'click', function() {
                    closeAllInfowindows();
                    map.setLevel(4, {animate: true});
                    map.panTo(marker.getPosition());
                    infowindow.open(map, marker);
                });
            });
        }

        function moveToPark(lat, lng) {
            var moveLatLon = new kakao.maps.LatLng(lat, lng);
            map.setLevel(4, {animate: true});
            map.panTo(moveLatLon);
            closeAllInfowindows();
            var targetMarker = markers.find(function(m) { return m.getPosition().getLat().toFixed(6) == lat.toString() && m.getPosition().getLng().toFixed(6) == lng.toString(); });
            if(targetMarker) { 
                var realIndex = skateParks.findIndex(function(p) { return p.lat === lat && p.lng === lng; });
                if(realIndex >= 0 && infowindows[realIndex]) infowindows[realIndex].open(map, targetMarker);
            }
        }
        function closeAllInfowindows() { for(var i=0; i<infowindows.length; i++) { infowindows[i].close(); } }
        function filterList(type) {
            var btns = document.querySelectorAll('.filter-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            if(type === 'all') { renderList(skateParks); } 
            else { renderList(skateParks.filter(function(item) { return item.levelClass === type; })); }
        }
    </script>
</body>
</html>